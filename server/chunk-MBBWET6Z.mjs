import './polyfills.server.mjs';
import{E as v,Fa as l,Ga as g,Sa as A,W as w,X as j,a as k,e as S,i as M,p,s as K,t as h}from"./chunk-LOAOCB3Z.mjs";import{a as o,b as d}from"./chunk-5XUXGTUW.mjs";var $=(()=>{let t=class t{constructor(e){this.http=e,this.apiUrl="https://api5.angular-buch.com"}getAll(){return this.http.get(`${this.apiUrl}/books`).pipe(M(e=>(console.error(e),S([]))))}getSingle(e){return this.http.get(`${this.apiUrl}/books/${e}`)}remove(e){return this.http.delete(`${this.apiUrl}/books/${e}`)}getAllSearch(e){return this.http.get(`${this.apiUrl}/books/search/${e}`).pipe(M(s=>(console.error(s),S([]))))}create(e){return this.http.post(`${this.apiUrl}/books`,e)}update(e){return this.http.put(`${this.apiUrl}/books/${e.isbn}`,e)}};t.\u0275fac=function(s){return new(s||t)(K(A))},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var P=new WeakMap,c=Symbol("STATE_SOURCE");function B(n,...t){n[c].update(i=>t.reduce((e,s)=>o(o({},e),typeof s=="function"?s(e):s),i)),X(n)}function Q(n){return n[c]()}function V(n){return P.get(n[c][k])||[]}function X(n){let t=V(n);for(let i of t){let e=g(()=>Q(n));i(e)}}function U(n){let t=g(()=>n());return Y(t)?new Proxy(n,{get(i,e){return e in t?(w(i[e])||Object.defineProperty(i,e,{value:l(()=>i()[e]),configurable:!0}),U(i[e])):i[e]}}):n}function Y(n){return n?.constructor===Object}function R(...n){let t=[...n],i=typeof t[0]=="function"?{}:t.shift(),e=t;return(()=>{class r{constructor(){let u=e.reduce((y,z)=>z(y),Z()),{stateSignals:m,computedSignals:q,methods:G,hooks:L}=u,E=o(o(o({},m),q),G);this[c]=i.protectedState===!1?u[c]:u[c].asReadonly();for(let y in E)this[y]=E[y];let{onInit:b,onDestroy:I}=L;b&&b(),I&&h(v).onDestroy(I)}static \u0275fac=function(m){return new(m||r)};static \u0275prov=p({token:r,factory:r.\u0275fac,providedIn:i.providedIn||null})}return r})()}function Z(){return{[c]:j({}),stateSignals:{},computedSignals:{},methods:{},hooks:{}}}function C(n,...t){let i=typeof n=="function"?[n,...t]:t;return e=>i.reduce((s,r)=>r(s),e)}function N(n){return t=>{let i=n(o(o({},t.stateSignals),t.computedSignals));return Object.keys(i),d(o({},t),{computedSignals:o(o({},t.computedSignals),i)})}}function T(n){return t=>{let i=o(o(o({[c]:t[c]},t.stateSignals),t.computedSignals),t.methods),e=typeof n=="function"?n(i):n,s=r=>{let a=e[r],u=t.hooks[r];return a?()=>{u&&u(),a(i)}:u};return d(o({},t),{hooks:{onInit:s("onInit"),onDestroy:s("onDestroy")}})}}function x(n){return t=>{let i=n(o(o(o({[c]:t[c]},t.stateSignals),t.computedSignals),t.methods));return Object.keys(i),d(o({},t),{methods:o(o({},t.methods),i)})}}function D(n){return t=>{let i=typeof n=="function"?n():n,e=Object.keys(i);t[c].update(r=>o(o({},r),i));let s=e.reduce((r,a)=>{let u=l(()=>t[c]()[a]);return d(o({},r),{[a]:U(u)})},{});return d(o({},t),{stateSignals:o(o({},t.stateSignals),s)})}}var f=function(n){return n[n.None=0]="None",n[n.Entities=1]="Entities",n[n.Both=2]="Both",n}(f||{}),F=n=>n.id;function _(n){return n?.selectId??F}function H(n){let t=n?.collection,i=t===void 0?"entityMap":`${t}EntityMap`,e=t===void 0?"ids":`${t}Ids`,s=t===void 0?"entities":`${t}Entities`;return{entityMapKey:i,idsKey:e,entitiesKey:s}}function tt(n,t,i){let e=i(t);return n.entityMap[e]?(n.entityMap[e]=t,f.Entities):(n.entityMap[e]=t,n.ids.push(e),f.Both)}function nt(n,t,i){let e=f.None;for(let s of t){let r=tt(n,s,i);e!==f.Both&&(e=r)}return e}function W(n,t){let i=_(t),e=H(t);return()=>{let s={entityMap:{},ids:[]};return nt(s,n,i),{[e.entityMapKey]:s.entityMap,[e.idsKey]:s.ids}}}function O(n){let{entityMapKey:t,idsKey:i,entitiesKey:e}=H(n);return C(D({[t]:{},[i]:[]}),N(s=>({[e]:l(()=>{let r=s[t]();return s[i]().map(u=>r[u])})})))}var et=n=>n.isbn,It=R({providedIn:"root"},O({entity:void 0,collection:"book"}),x(n=>{let t=h($);return{load(){t.getAll().subscribe(i=>{B(n,W(i,{collection:"book",selectId:et}))})}}}),T({onInit({load:n}){n()}}));export{$ as a,It as b};
